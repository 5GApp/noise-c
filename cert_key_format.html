<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Noise-C: Certificate and private key format</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Noise-C
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Certificate and private key format </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#cert_examples">Certificate format examples</a></li>
<li class="level1"><a href="#cert_format">Certificate format details</a><ul><li class="level2"><a href="#cert_overall_format">Top level of certificates and certificate chains</a></li>
<li class="level2"><a href="#cert_subject">Subject information</a></li>
<li class="level2"><a href="#cert_signature">Signature blocks</a></li>
<li class="level2"><a href="#cert_other">Other issues</a></li>
</ul>
</li>
<li class="level1"><a href="#key_format">Encrypted private key format</a></li>
<li class="level1"><a href="#fingerprints">Public key fingerprints</a></li>
</ul>
</div>
<div class="textblock"><p>This document describes certificate and private key formats that are proposed for use in implementations of Noise.</p>
<p>The certificate format is represented on the wire using <a href="https://developers.google.com/protocol-buffers/">Protocol Buffers</a> or "protobufs" for short. The full protocol description is contained in the <a class="el" href="noise_certificate_proto.html">noise-certificate.proto</a> file in the Noise-C distribution.</p>
<h1><a class="anchor" id="cert_examples"></a>
Certificate format examples</h1>
<p>The following is an example of a certificate for "Jane Smith" that has been signed by "Trent Peoples". To make things easier, we will use a simplified text syntax for describing the contents of a protobuf message. The data is actually encoded in binary on the wire using the standard <a href="https://developers.google.com/protocol-buffers/docs/encoding">Protocol Buffers Encoding</a>.</p>
<div class="fragment"><div class="line">Certificate {</div>
<div class="line">    version: 1</div>
<div class="line">    subject: SubjectInfo {</div>
<div class="line">        <span class="keywordtype">id</span>: <span class="stringliteral">&quot;jane.smith@example.com&quot;</span></div>
<div class="line">        name: <span class="stringliteral">&quot;Jane Smith&quot;</span></div>
<div class="line">        role: <span class="stringliteral">&quot;foo-chat-user&quot;</span></div>
<div class="line">        keys: [</div>
<div class="line">            PublicKeyInfo {</div>
<div class="line">                algorithm: <span class="stringliteral">&quot;25519&quot;</span></div>
<div class="line">                key: <span class="stringliteral">&quot;0xf14a2dedf6e1dd879a3af47900eedf17ae56868a7849a370ca732a571ef19e0f&quot;</span></div>
<div class="line">            }</div>
<div class="line">            PublicKeyInfo {</div>
<div class="line">                algorithm: <span class="stringliteral">&quot;448&quot;</span></div>
<div class="line">                key: <span class="stringliteral">&quot;0xd414a46bed6231540306818bdab08d8b06a28d98d0bfca47bcea1faf1aca78d8aabc7d7c2073779bd84cf0950ae10247975266267eebb1c8&quot;</span></div>
<div class="line">            }</div>
<div class="line">        ]</div>
<div class="line">    }</div>
<div class="line">    signatures: [</div>
<div class="line">        Signature {</div>
<div class="line">            <span class="keywordtype">id</span>: <span class="stringliteral">&quot;tpeoples@example.org&quot;</span></div>
<div class="line">            name: <span class="stringliteral">&quot;Trent Peoples&quot;</span></div>
<div class="line">            signing_key: PublicKeyInfo {</div>
<div class="line">                algorithm: <span class="stringliteral">&quot;Ed25519&quot;</span></div>
<div class="line">                key: <span class="stringliteral">&quot;0x0fdde4a7a7cc91ec509a74bd5f2369ac768a14bb6388ceb2e1710a4b85bfe001&quot;</span></div>
<div class="line">            }</div>
<div class="line">            hash_algorithm: <span class="stringliteral">&quot;BLAKE2b&quot;</span></div>
<div class="line">            extra_signed_info: ExtraSignedInfo {</div>
<div class="line">                nonce: <span class="stringliteral">&quot;0xa2bf177b31bd60ee0e8e00097d88e48e&quot;</span></div>
<div class="line">                valid_from: <span class="stringliteral">&quot;2016-03-15T00:00:00Z&quot;</span></div>
<div class="line">                valid_to: <span class="stringliteral">&quot;2026-03-15T23:59:59Z&quot;</span></div>
<div class="line">            }</div>
<div class="line">            signature: <span class="stringliteral">&quot;0x40fa37936793009750ca45e9ef1eb246eaaded93ddd356e7120e0dc171cfa51ff26b7d7a95ba9498d717bff6b9e5d5eeb0a4bbdbf7bcd8c5c4b617da36a68ed9&quot;</span></div>
<div class="line">        }</div>
<div class="line">    ]</div>
<div class="line">}</div>
</div><!-- fragment --><p>Here, Jane has declared that her Curve25519 and Curve448 Diffie-Hellman keys will be used in the "foo-chat-user" role. Trent then accepted that role, hashed the certificate data with "BLAKE2b", and added his signature using the "Ed25519" algorithm.</p>
<p>The signature covers the contents of the "subject" and "extra_signed_info" fields, represented in the standard <a href="https://developers.google.com/protocol-buffers/docs/encoding">Protocol Buffers Encoding</a>. The encoding MUST be "canonical" in that all integer values, field tag numbers, and field lengths are represented using the minimum number of bytes for the value, and the fields are listed strictly in order of field tag number.</p>
<p>Multiple signature blocks can be included from multiple signers:</p>
<div class="fragment"><div class="line">signatures: [</div>
<div class="line">    Signature {</div>
<div class="line">        <span class="keywordtype">id</span>: <span class="stringliteral">&quot;tpeoples@example.org&quot;</span></div>
<div class="line">        name: <span class="stringliteral">&quot;Trent Peoples&quot;</span></div>
<div class="line">        signing_key: PublicKeyInfo {</div>
<div class="line">            algorithm: <span class="stringliteral">&quot;Ed25519&quot;</span></div>
<div class="line">            key: <span class="stringliteral">&quot;0x0fdde4a7a7cc91ec509a74bd5f2369ac768a14bb6388ceb2e1710a4b85bfe001&quot;</span></div>
<div class="line">        }</div>
<div class="line">        hash_algorithm: <span class="stringliteral">&quot;BLAKE2b&quot;</span></div>
<div class="line">        extra_signed_info: ExtraSignedInfo {</div>
<div class="line">            nonce: <span class="stringliteral">&quot;0xa2bf177b31bd60ee0e8e00097d88e48e&quot;</span></div>
<div class="line">            valid_from: <span class="stringliteral">&quot;2016-03-15T00:00:00Z&quot;</span></div>
<div class="line">            valid_to: <span class="stringliteral">&quot;2026-03-15T23:59:59Z&quot;</span></div>
<div class="line">        }</div>
<div class="line">        signature: <span class="stringliteral">&quot;0x40fa37936793009750ca45e9ef1eb246eaaded93ddd356e7120e0dc171cfa51ff26b7d7a95ba9498d717bff6b9e5d5eeb0a4bbdbf7bcd8c5c4b617da36a68ed9&quot;</span></div>
<div class="line">    }</div>
<div class="line">    Signature {</div>
<div class="line">        <span class="keywordtype">id</span>: <span class="stringliteral">&quot;mary.sue@example.com&quot;</span></div>
<div class="line">        name: <span class="stringliteral">&quot;Mary Sue&quot;</span></div>
<div class="line">        signing_key: PublicKeyInfo {</div>
<div class="line">            algorithm: <span class="stringliteral">&quot;Ed25519&quot;</span></div>
<div class="line">            key: <span class="stringliteral">&quot;0x8e15998d97f9b43150f05d1b895f5272a2ff1453dbf40ee4ea90df81147db5c3&quot;</span></div>
<div class="line">        }</div>
<div class="line">        hash_algorithm: <span class="stringliteral">&quot;SHA512&quot;</span></div>
<div class="line">        extra_signed_info: ExtraSignedInfo {</div>
<div class="line">            nonce: <span class="stringliteral">&quot;0x024e95d2a060df2be5e1fbdfe8e31c58&quot;</span></div>
<div class="line">            valid_from: <span class="stringliteral">&quot;2015-05-17T00:00:00Z&quot;</span></div>
<div class="line">            valid_to: <span class="stringliteral">&quot;2025-05-17T23:59:59Z&quot;</span></div>
<div class="line">        }</div>
<div class="line">        signature: <span class="stringliteral">&quot;0x833243ed18ac609880446c1ea147f6322db98ef9d2eaba30ece46bf7cabe50cd822fbe369f4c9c6bd8a5a5f400fff732f1a29c4113e12cb23138733ca880126d&quot;</span></div>
<div class="line">    }</div>
<div class="line">]</div>
</div><!-- fragment --><p>Each signature is independent, covering the "subject" information and continuing with the "extra_signed_info" details for the specific signer. In the above example, Mary's signature does not include the details from Trent. The certificate would be equally valid with Mary's signature listed first.</p>
<p>Because the signatures are independent, new signatures can be added to the end of the certificate at any time. Or old signatures can be removed from the certificate at any time. Any remaining signatures will remain valid as they only vouch for Jane's identity, not the identity of the other signers.</p>
<p>This approach also allows certificates to be trimmed when they are sent in Noise packets. If the client is communicating with a server that trusts Trent as a certificate authority, then there is no need to send the signature block for Mary. Certificates may also be trimmed to hide the identity of additional signers from remote parties that do not need to know about those signers.</p>
<dl class="section note"><dt>Note</dt><dd>Signatures provide additional information that may help bind a key to an identity for specific use cases, but signatures are not necessary for secure communication to occur. Protocols should keep this in mind when using Noise certificates. The lack of a signature does not imply that the user is untrustworthy. It only implies that the user has not found anyone yet who they trust to sign their certificate. Other strategies such as "Trust On First Use" can be used to manage certificates that lack signatures.</dd></dl>
<h1><a class="anchor" id="cert_format"></a>
Certificate format details</h1>
<p>The format details below are specified in the <a href="https://developers.google.com/protocol-buffers/docs/proto3">proto3</a> language.</p>
<h2><a class="anchor" id="cert_overall_format"></a>
Top level of certificates and certificate chains</h2>
<p>The top level of a certificate contains a version number, information about the subject, and any optional signatures:</p>
 <div class="fragment"><div class="line">message Certificate {</div>
<div class="line">    reserved 4 to 15;</div>
<div class="line">    uint32 version = 1;</div>
<div class="line">    SubjectInfo subject = 2;</div>
<div class="line">    repeated Signature signatures = 3;</div>
<div class="line">}</div>
</div><!-- fragment --></p>
<p>The version number MUST be 1 for this version of the format.</p>
<p>In all of the definitions here, field tags 1 to 15 are intended for use by this format description (or future versions of it). Field tags 16 and higher are available for private use extensions, although this shouldn't be necessary because the "meta" field described later provides a standard way to add extensions.</p>
<p>Certificate chains are a list of one or more certificates:</p>
 <div class="fragment"><div class="line">message CertificateChain {</div>
<div class="line">    reserved 1 to 7, 9 to 15;</div>
<div class="line">    repeated Certificate certs = 8;</div>
<div class="line">}</div>
</div><!-- fragment --></p>
<p>The field tag number on the certificates in a chain is deliberately set to 8, which is different than any of the field tags in "Certificate". This allows applications to quickly determine if the supplied data is a single certificate or a certificate chain.</p>
<p>When a chain of certificates is given, the first is assumed to be the subject with the remainder of the certificates intended to provide additional information to verify the subject.</p>
<h2><a class="anchor" id="cert_subject"></a>
Subject information</h2>
 <div class="fragment"><div class="line">message SubjectInfo {</div>
<div class="line">    reserved 6 to 15;</div>
<div class="line">    <span class="keywordtype">string</span> <span class="keywordtype">id</span> = 1;</div>
<div class="line">    <span class="keywordtype">string</span> name = 2;</div>
<div class="line">    <span class="keywordtype">string</span> role = 3;</div>
<div class="line">    repeated PublicKeyInfo keys = 4;</div>
<div class="line">    repeated MetaInfo meta = 5;</div>
<div class="line">}</div>
</div><!-- fragment --></p>
<p><code>id</code> - The identity of the subject, formatted as "foo@domain" and encoded in UTF-8. The <code>Id</code> may look like an e-mail address but it doesn't have to be. It only needs to be unique in the context of the larger Noise protocol.</p>
<p><code>name</code> - The name of the subject for the certificate. This string is intended to be human-readable and MUST be encoded in UTF-8. If the <code>name</code> is not present, <code>id</code> can be displayed to the human user instead.</p>
<p>Both <code>id</code> and <code>name</code> are OPTIONAL. If neither are present, then the subject is identified by their public key fingerprint. This option is provided to protect the identity of anonymous users. A pseudonym could be used instead, but pseudonym use is not required.</p>
<p><code>role</code> - The role that the subject's keys are intended to be used for. There are no predefined roles yet and the field can be omitted. The role may be an application name; e.g. "foo-chat", or a sub-role within an application; e.g. "foo-chat-user" and "foo-chat-server".</p>
<p><code>keys</code> - List of public keys for the subject.</p>
 <div class="fragment"><div class="line">message PublicKeyInfo {</div>
<div class="line">    reserved 3 to 15;</div>
<div class="line">    <span class="keywordtype">string</span> algorithm = 1;       <span class="comment">// &quot;25519&quot;, &quot;448&quot;, &quot;Ed25519&quot;, etc.</span></div>
<div class="line">    bytes key = 2;              <span class="comment">// Format depends upon the algorithm.</span></div>
<div class="line">}</div>
</div><!-- fragment --></p>
<p><code>meta</code> - Extra meta information about the subject as a list of freeform name/value pairs:</p>
 <div class="fragment"><div class="line">message MetaInfo {</div>
<div class="line">    reserved 3 to 15;</div>
<div class="line">    <span class="keywordtype">string</span> name = 1;</div>
<div class="line">    <span class="keywordtype">string</span> value = 2;</div>
<div class="line">}</div>
</div><!-- fragment --></p>
<p>MetaInfo blocks may be used to add extra information that is of interest to an application. For example, "Foo-Nickname" may convey the nickname of a user for the "foo-chat" application. For privacy reasons, any meta information that may identify the user MUST be OPTIONAL. Applications SHOULD use meta names that are obviously unique to that application to avoid conflict with other applications.</p>
<h2><a class="anchor" id="cert_signature"></a>
Signature blocks</h2>
 <div class="fragment"><div class="line">message Signature {</div>
<div class="line">    reserved 6 to 14;</div>
<div class="line">    <span class="keywordtype">string</span> <span class="keywordtype">id</span> = 1;</div>
<div class="line">    <span class="keywordtype">string</span> name = 2;</div>
<div class="line">    PublicKeyInfo signing_key = 3;</div>
<div class="line">    <span class="keywordtype">string</span> hash_algorithm = 4;</div>
<div class="line">    ExtraSignedInfo extra_signed_info = 5;</div>
<div class="line">    bytes signature = 15;</div>
<div class="line">}</div>
</div><!-- fragment --></p>
<p>The <code>id</code> and <code>name</code> fields have the same format and meaning as for subject information blocks. In this case they identify the signer. Both fields can be omitted to hide the identity of the signer.</p>
<p>The <code>signing_key</code> field specifies the algorithm name and public key that was used to sign the certificate.</p>
<p>The <code>hash_algorithm</code> indicates the algorithm that was used to hash the subject information and <code>extra_signed_info</code>. It should be one of <code>BLAKE2s</code>, <code>BLAKE2b</code>, <code>SHA256</code>, or <code>SHA512</code>. <code>BLAKE2b</code> or <code>SHA512</code> is recommended to ensure signature longevity.</p>
<p>The <code>extra_signed_info</code> field contains information that is signed along with the subject information:</p>
 <div class="fragment"><div class="line">message ExtraSignedInfo {</div>
<div class="line">    reserved 5 to 15;</div>
<div class="line">    bytes nonce = 1;</div>
<div class="line">    <span class="keywordtype">string</span> valid_from = 2;      <span class="comment">// ISO 8601 format timestamp.</span></div>
<div class="line">    <span class="keywordtype">string</span> valid_to = 3;        <span class="comment">// ISO 8601 format timestamp.</span></div>
<div class="line">    repeated MetaInfo meta = 4;</div>
<div class="line">}</div>
</div><!-- fragment --></p>
<p>The <code>nonce</code> is an extra pseudorandom value added by the signer, which ensures that multiple signatures for the same subject from the same signer will be different. The value should be considered opaque. It is recommended that it consist of at least 128 bits of pseudorandom data. This field SHOULD be included. It MAY be omitted for anonymous users to avoid the watermarking problems described under <a class="el" href="cert_key_format.html#cert_other">Other issues</a> below. The <code>valid_from</code> field SHOULD be included in this case to provide a fallback nonce that is different between signatures.</p>
<p>The <code>valid_from</code> and <code>valid_to</code> OPTIONAL fields indicate the starting and ending times for the validity of the signature. Note: This is the validity of the signature, not of the certificate. The signer is not saying "this key is valid for this period" but rather "I do not vouch for this certificate outside this time period". The subject information may remain valid for much longer. The format MUST comply with <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> as profiled in <a href="https://tools.ietf.org/html/rfc3339">RFC 3339</a>.</p>
<p>The <code>signature</code> field MUST be the last line in the <code>Signature</code> block, and contains the actual signature produced with the <code>signing_key</code> and <code>hash_algorithm</code>.</p>
<p>If there were any existing <code>Signature</code> blocks in the certificate to be signed, they are ignored when calculating the hash. The new signature block is inserted at the end of the certificate.</p>
<h2><a class="anchor" id="cert_other"></a>
Other issues</h2>
<p>Any strings that are read from a certificate and presented to a human user should be preprocessed to remove or transform control characters or other data that may be problematic for the output device. The security considerations from <a href="https://tools.ietf.org/html/rfc3629">RFC 3629</a> should be kept in mind to ensure that all strings are strict UTF-8.</p>
<p>The <code>nonce</code> value and implementation-specific meta fields could be used to watermark users who otherwise wish to remain anonymous. Once a certificate is signed, the subject will need to import the signature into their key ring. At this point the subject can see if any extra fields were inserted that concern them and reject the signature.</p>
<p>The <code>nonce</code> field is opaque and non-obvious but highly recommended to deal with duplicate signatures for the same subject key. The <code>nonce</code> field MAY be omitted by a signer from certificates if they wish to provide some assurance to anonymous users that they have not watermarked the signature. The <code>valid_from</code> field is used as a fallback nonce for this case.</p>
<p>Anonymous users can choose to reject signatures that include a <code>nonce</code>. They should also carefully inspect the <code>valid_from</code> and <code>valid_to</code> timestamps. Odd date or time values might provide another opportunity to include watermarking bits.</p>
<p>The main protection against this is disclosure. If it was discovered that well-known signing authorities were watermarking certificates, affected users can remove the offending signatures and seek new signers.</p>
<p>Signers may require some kind of proof that the subject is in possession of the relevant key before adding a signature. For Diffie-Hellman keys, the Noise protocol itself provides handshake patterns that can prove key possession.</p>
<p>A hypothetical certificate issuing protocol should check that the static public key for the session matches that in the supplied certificate. This does become more complex if the subject has multiple encryption keys or signing keys. Multiple requests may be necessary to prove ownership of the additional keys.</p>
<h1><a class="anchor" id="key_format"></a>
Encrypted private key format</h1>
<p>The private key information is similar to the subject information from the certificate format:</p>
 <div class="fragment"><div class="line">message PrivateKey {</div>
<div class="line">    reserved 6 to 15;</div>
<div class="line">    <span class="keywordtype">string</span> <span class="keywordtype">id</span> = 1;</div>
<div class="line">    <span class="keywordtype">string</span> name = 2;</div>
<div class="line">    <span class="keywordtype">string</span> role = 3;</div>
<div class="line">    repeated PrivateKeyInfo keys = 4;</div>
<div class="line">    repeated MetaInfo meta = 5;</div>
<div class="line">}</div>
<div class="line">message PrivateKeyInfo {</div>
<div class="line">    reserved 3 to 15;</div>
<div class="line">    <span class="keywordtype">string</span> algorithm = 1;       <span class="comment">// &quot;25519&quot;, &quot;448&quot;, &quot;Ed25519&quot;, etc.</span></div>
<div class="line">    bytes key = 2;              <span class="comment">// Format depends upon the algorithm.</span></div>
<div class="line">}</div>
</div><!-- fragment --></p>
<p>The format of "PrivateKey" and "PrivateKeyInfo" are identical to "SubjectInfo" and "PublicKeyInfo", which may allow applications to share the format handling code between the two use cases if they so wish.</p>
<p>The private key information is encrypted to protect it inside an "EncryptedPrivateKey" wrapper:</p>
 <div class="fragment"><div class="line">message EncryptedPrivateKey {</div>
<div class="line">    reserved 1 to 9, 14;</div>
<div class="line">    uint32 version = 10;        <span class="comment">// 1 for this version of the format.</span></div>
<div class="line">    <span class="keywordtype">string</span> algorithm = 11;      <span class="comment">// e.g. &quot;ChaChaPoly_BLAKE2b_PBKDF2&quot;.</span></div>
<div class="line">    bytes salt = 12;            <span class="comment">// Salt value for input to the KDF.</span></div>
<div class="line">    uint32 iterations = 13;     <span class="comment">// Iteration count for the KDF.</span></div>
<div class="line">    bytes encrypted_data = 15;  <span class="comment">// Encrypted version of PrivateKey.</span></div>
<div class="line">}</div>
</div><!-- fragment --></p>
<p>For example:</p>
<div class="fragment"><div class="line">EncryptedPrivateKey {</div>
<div class="line">    version: 1</div>
<div class="line">    algorithm: <span class="stringliteral">&quot;ChaChaPoly_BLAKE2b_PBKDF2&quot;</span></div>
<div class="line">    salt: <span class="stringliteral">&quot;0x1621bb322ca96658eb6172d01031845f&quot;</span></div>
<div class="line">    iterations: 50000</div>
<div class="line">    encrypted_data: <span class="stringliteral">&quot;0x...&quot;</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>The <code>version</code> must be 1 for this version of the encrypted private key format.</p>
<p>The <code>algorithm</code> indicates the cipher, hash, and KDF schemes that are used to protect the private key. Any Noise cipher or hash algorithm supported by the application can be used, although "ChaChaPoly_BLAKE2b_PBKDF2" is recommended for minimum interoperability.</p>
<p>The only KDF algorithm that is defined at present is PBKDF2 from <a href="https://www.ietf.org/rfc/rfc2898.txt">RFC 2898</a>. The <code>salt</code> and <code>iterations</code> fields are two of the parameters to PBKDF2 (the other being the passphrase).</p>
<p>Other KDF algorithms may be defined in the future. The <code>salt</code> and <code>iterations</code> fields can be repurposed to contain whatever parameters those KDF algorithms require.</p>
<p>As an example, the algorithm identifier "ChaChaPoly_BLAKE2b_PBKDF2" is implemented as follows. PBKDF2 is used with BLAKE2b to generate an encryption key and nonce for ChaChaPoly. The first 32 bytes of the PBKDF2 output are used as the encryption key. The next 8 bytes of the PBKDF2 output are interpreted as a big-endian 64-bit value and used as the nonce. The entirety of the private key details are encrypted in a single request, which limits the size to 65535 bytes including the MAC.</p>
<dl class="section note"><dt>Note</dt><dd>The nonce value 2^64 - 1 (0xFFFFFFFFFFFFFFFF) is reserved by revision 30 of the Noise specification. If the PBKDF2 hashing process generates such a nonce, then the implementation should generate a new salt and hash the passphrase again. This situation is highly unlikely.</dd></dl>
<p>The <code>salt</code> SHOULD be at least 16 bytes in length, and MAY be longer at the implementation's discretion. The unsigned 32-bit <code>iteration</code> count should be large enough to make dictionary attacks on the private key file time-consuming on current hardware.</p>
<p>Encrypted private keys can be a hassle for servers and other systems that run unattended. Such systems may need to use a static passphrase, even if only the empty passphrase.</p>
<p>The field tag numbers on "EncryptedPrivateKey" are deliberately different than those for "Certificate" and "CertificateChain" so that an application can easily determine what type of data it is processing. Applications may use this to cross-check that a private key is not accidentally sent over the wire as a certificate.</p>
<h1><a class="anchor" id="fingerprints"></a>
Public key fingerprints</h1>
<p>When displaying a public key to a human user, the public key SHOULD be hashed with SHA256 with the first 16 bytes of the value formatted in hexadecimal, separated by colons. For example:</p>
<div class="fragment"><div class="line">34:da:01:7b:07:e1:a0:0d:64:14:be:e9:af:cf:db:7b</div>
</div><!-- fragment --><p>Fingerprints MAY be calculated with other hash algorithms or MAY include more than 16 bytes. However, SHA256 with truncation is RECOMMENDED to improve interoperability of fingerprints between implementations. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Jul 23 2016 06:34:13 for Noise-C by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
